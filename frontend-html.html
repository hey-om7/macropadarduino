<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Modern Keyboard Shortcut Grid</title>
  <!-- <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"> -->
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Inter', sans-serif;
    }

    body {
      background: linear-gradient(135deg, #0f172a, #1e293b);
      color: #f0f0f0;
      min-height: 100vh;
      padding: 40px 20px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .container {
      max-width: 1200px;
      width: 100%;
      background: rgba(15, 23, 42, 0.7);
      backdrop-filter: blur(12px);
      border-radius: 24px;
      padding: 40px;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3),
        0 0 0 1px rgba(255, 217, 0, 0.1);
      border: 1px solid rgba(255, 217, 0, 0.15);
    }

    header {
      text-align: center;
      margin-bottom: 25px;
      position: relative;
    }

    h1 {
      font-size: 2.8rem;
      font-weight: 700;
      margin-bottom: 12px;
      background: linear-gradient(to right, #ffd700, #ffb700);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 2px 10px rgba(255, 215, 0, 0.2);
    }

    .subtitle {
      font-size: 1.1rem;
      color: #94a3b8;
      max-width: 600px;
      margin: 0 auto;
      line-height: 1.6;
    }

    .controls {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
      margin-bottom: 40px;
      flex-wrap: wrap;
    }

    .dropdown {
      position: relative;
      min-width: 200px;
    }

    select {
      width: 100%;
      padding: 14px 20px;
      font-size: 16px;
      border-radius: 14px;
      border: none;
      background: rgba(30, 41, 59, 0.8);
      color: #e2e8f0;
      appearance: none;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2),
        inset 0 0 0 1px rgba(255, 217, 0, 0.2);
      transition: all 0.3s ease;
    }

    select:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(255, 217, 0, 0.4),
        inset 0 0 0 1px rgba(255, 217, 0, 0.3);
    }

    select:hover {
      background: rgba(41, 55, 80, 0.8);
    }

    .dropdown::after {
      content: "▼";
      position: absolute;
      top: 50%;
      right: 20px;
      transform: translateY(-50%);
      color: #ffd700;
      pointer-events: none;
      font-size: 12px;
    }

    .btn {
      background: linear-gradient(to right, #ffd700, #ffb700);
      color: #0f172a;
      border: none;
      padding: 14px 28px;
      border-radius: 14px;
      font-weight: 600;
      font-size: 16px;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3),
        0 0 0 1px rgba(255, 217, 0, 0.3);
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 7px 20px rgba(255, 215, 0, 0.4),
        0 0 0 1px rgba(255, 217, 0, 0.4);
    }

    .btn:active {
      transform: translateY(1px);
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-bottom: 20px;
    }

    .key-box {
      background: linear-gradient(145deg, rgba(30, 41, 59, 0.8), rgba(15, 23, 42, 0.8));
      border-radius: 20px;
      padding: 20px 15px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3),
        inset 0 0 0 1px rgba(255, 217, 0, 0.15);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 120px;
      position: relative;
      overflow: hidden;
    }

    .key-box:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 35px rgba(0, 0, 0, 0.4),
        0 0 0 2px rgba(255, 217, 0, 0.25);
    }

    .key-box::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255, 215, 0, 0.1) 0%, transparent 70%);
      opacity: 0;
      transition: opacity 0.4s ease;
    }

    .key-box:hover::before {
      opacity: 1;
    }

    .key-box .action-label {
      font-size: 1rem;
      color: #e2e8f0;
      font-weight: 500;
      margin-bottom: 10px;
    }

    .key-box .shortcut-text {
      font-size: 0.9rem;
      color: #e2e8f0;
      font-weight: 500;
      margin-top: 10px;
      min-height: 20px;
    }

    /* Modal styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 9999;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(5px);
    }

    .modal-content {
      background: rgba(15, 23, 42, 0.9);
      backdrop-filter: blur(12px);
      margin: 5% auto;
      padding: 20px 24px;
      border-radius: 24px;
      width: 90%;
      max-width: 800px;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5),
        0 0 0 1px rgba(255, 217, 0, 0.15);
      border: 1px solid rgba(255, 217, 0, 0.15);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      padding-bottom: 10px;
    }

    .modal-title {
      background: linear-gradient(to right, #ffd700, #ffb700);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-size: 1.4rem;
      font-weight: 600;
    }

    .close {
      color: #94a3b8;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      transition: color 0.3s ease;
      background: none;
      border: none;
      padding: 5px;
      border-radius: 8px;
    }

    .close:hover {
      color: #ffd700;
      background: rgba(255, 217, 0, 0.1);
    }

    .keyboard-illustration {
      background: rgba(30, 41, 59, 0.6);
      border-radius: 16px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: inset 0 0 0 1px rgba(255, 217, 0, 0.1);
    }

    .keyboard-illustration h2 {
      text-align: center;
      margin-bottom: 20px;
      background: linear-gradient(to right, #ffd700, #ffb700);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-size: 1.4rem;
      font-weight: 600;
    }

    .keyboard-row {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 8px;
    }

    .key-display {
      background: rgba(15, 23, 42, 0.8);
      margin: 3px;
      padding: 10px 14px;
      border-radius: 8px;
      font-size: 12px;
      min-width: 35px;
      text-align: center;
      transition: all 0.3s ease;
      color: #e2e8f0;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3),
        inset 0 0 0 1px rgba(255, 217, 0, 0.1);
    }

    .key-display:hover {
      background: rgba(41, 55, 80, 0.8);
      transform: translateY(-2px);
    }

    .key-display.pressed {
      background: linear-gradient(to right, #ffd700, #ffb700);
      color: #0f172a;
      font-weight: bold;
      transform: translateY(-3px);
      box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
    }

    .key-display.space {
      min-width: 120px;
    }

    .modal-controls {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 30px;
    }

    .modal-btn {
      padding: 14px 28px;
      border: none;
      border-radius: 14px;
      cursor: pointer;
      font-weight: 600;
      font-size: 16px;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .modal-btn.primary {
      background: linear-gradient(to right, #ffd700, #ffb700);
      color: #0f172a;
      box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
    }

    .modal-btn.primary:hover {
      transform: translateY(-3px);
      box-shadow: 0 7px 20px rgba(255, 215, 0, 0.4);
    }

    .modal-btn.secondary {
      background: rgba(30, 41, 59, 0.8);
      color: #e2e8f0;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2),
        inset 0 0 0 1px rgba(255, 217, 0, 0.2);
    }

    .modal-btn.secondary:hover {
      background: rgba(41, 55, 80, 0.8);
      transform: translateY(-3px);
    }

    /* WiFi Modal Styles */
    .wifi-form {
      display: flex;
      flex-direction: column;
      gap: 25px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .form-label {
      font-size: 1.1rem;
      font-weight: 600;
      color: #ffd700;
      margin-bottom: 5px;
    }

    .form-input {
      width: 100%;
      padding: 16px 20px;
      font-size: 16px;
      border-radius: 14px;
      border: none;
      background: rgba(30, 41, 59, 0.8);
      color: #e2e8f0;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2),
        inset 0 0 0 1px rgba(255, 217, 0, 0.2);
      transition: all 0.3s ease;
    }

    .form-input:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(255, 217, 0, 0.4),
        inset 0 0 0 1px rgba(255, 217, 0, 0.3);
      background: rgba(41, 55, 80, 0.8);
    }

    .form-input::placeholder {
      color: #64748b;
    }

    .password-container {
      position: relative;
    }

    .password-toggle {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: #94a3b8;
      cursor: pointer;
      font-size: 18px;
      padding: 5px;
      border-radius: 6px;
      transition: all 0.3s ease;
    }

    .password-toggle:hover {
      color: #ffd700;
      background: rgba(255, 217, 0, 0.1);
    }

    .wifi-info {
      background: rgba(30, 41, 59, 0.6);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      border-left: 4px solid #ffd700;
    }

    .wifi-info-title {
      color: #ffd700;
      font-weight: 600;
      margin-bottom: 8px;
      font-size: 1.1rem;
    }

    .wifi-info-text {
      color: #94a3b8;
      line-height: 1.6;
    }

    @media (max-width: 600px) {
      .grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .modal-content {
        width: 95%;
        margin: 10% auto;
        padding: 25px;
      }

      .key-display {
        padding: 6px 10px;
        font-size: 11px;
        min-width: 25px;
      }

      .controls {
        flex-direction: column;
        gap: 15px;
      }

      .modal-controls {
        flex-direction: column;
        gap: 12px;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <header>
      <h1>Keyboard Shortcut Manager</h1>
      <p class="subtitle">Customize and visualize your keyboard shortcuts with our modern interface. Assign shortcuts to
        actions and see them displayed on the interactive keyboard.</p>
    </header>

    <div class="controls">
      <div class="dropdown">
        <select id="osSelect">
          <option value="mac">macOS</option>
          <option value="windows">Windows</option>
        </select>
      </div>

      <button class="btn" id="saveBtn">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Capa_1"
          x="0px" y="0px" viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve"
          width="14" height="14">
          <g>
            <circle cx="256" cy="298.667" r="42.667" />
            <path
              d="M480.768,87.936l-56.704-56.704c-5.674-5.585-11.957-10.515-18.731-14.699V64   c-0.071,58.881-47.786,106.596-106.667,106.667h-85.333C154.452,170.596,106.737,122.881,106.667,64V0   C47.786,0.071,0.071,47.786,0,106.667v298.667C0.071,464.215,47.786,511.93,106.667,512h298.667   C464.214,511.93,511.93,464.215,512,405.334V163.35C512.08,135.049,500.833,107.893,480.768,87.936z M256,384   c-47.128,0-85.333-38.205-85.333-85.333s38.205-85.333,85.333-85.333s85.333,38.205,85.333,85.333S303.128,384,256,384z" />
            <path
              d="M213.333,128h85.333c35.346,0,64-28.654,64-64V1.366c-4.638-0.756-9.32-1.212-14.016-1.365H149.333v64   C149.333,99.346,177.987,128,213.333,128z" />
          </g>
        </svg> Save Keymapping
      </button>

      <button class="btn" id="resetBtn">
        <svg fill="#000000" width="20px" height="20px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M19.146 4.854l-1.489 1.489A8 8 0 1 0 12 20a8.094 8.094 0 0 0 7.371-4.886 1 1 0 1 0-1.842-.779A6.071 6.071 0 0 1 12 18a6 6 0 1 1 4.243-10.243l-1.39 1.39a.5.5 0 0 0 .354.854H19.5A.5.5 0 0 0 20 9.5V5.207a.5.5 0 0 0-.854-.353z" />
        </svg> Reset to Defaults
      </button>
      <button class="btn" id="wifiBtn">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
          <path
            d="M1 9l2 2c4.97-4.97 13.03-4.97 18 0l2-2C16.93 2.93 7.07 2.93 1 9zm8 8l3 3 3-3c-1.65-1.66-4.34-1.66-6 0zm-4-4l2 2c2.76-2.76 7.24-2.76 10 0l2-2C15.14 9.14 8.87 9.14 5 13z" />
        </svg> WiFi Settings
      </button>
    </div>

    <div class="grid" id="shortcutGrid">
      <div class="key-box" onclick="openKeyboardModal(this, 0)">
        <div class="action-label">New Document</div>
        <div class="shortcut-text">Click to assign</div>
      </div>
      <div class="key-box" onclick="openKeyboardModal(this, 1)">
        <div class="action-label">Save File</div>
        <div class="shortcut-text">Click to assign</div>
      </div>
      <div class="key-box" onclick="openKeyboardModal(this, 2)">
        <div class="action-label">Copy Selection</div>
        <div class="shortcut-text">Click to assign</div>
      </div>
      <div class="key-box" onclick="openKeyboardModal(this, 3)">
        <div class="action-label">Paste Content</div>
        <div class="shortcut-text">Click to assign</div>
      </div>
      <div class="key-box" onclick="openKeyboardModal(this, 4)">
        <div class="action-label">Undo Action</div>
        <div class="shortcut-text">Click to assign</div>
      </div>
      <div class="key-box" onclick="openKeyboardModal(this, 5)">
        <div class="action-label">Find Text</div>
        <div class="shortcut-text">Click to assign</div>
      </div>
      <div class="key-box" onclick="openKeyboardModal(this, 6)">
        <div class="action-label">Toggle Fullscreen</div>
        <div class="shortcut-text">Click to assign</div>
      </div>
      <div class="key-box" onclick="openKeyboardModal(this, 7)">
        <div class="action-label">Print Document</div>
        <div class="shortcut-text">Click to assign</div>
      </div>
      <div class="key-box" onclick="openKeyboardModal(this, 8)">
        <div class="action-label">Refresh Page</div>
        <div class="shortcut-text">Click to assign</div>
      </div>
    </div>
  </div>
  <!-- Keyboard Modal -->
  <div id="keyboardModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="modalTitle">Assign Shortcut</h2>
        <span class="close" onclick="closeKeyboardModal()">&times;</span>
      </div>

      <div class="keyboard-illustration">
        <div class="keyboard-keys" id="keyboardKeys"></div>
      </div>

      <div class="modal-controls">
        <button class="modal-btn secondary" onclick="clearCurrentShortcut()">Clear Shortcut</button>
        <button class="modal-btn primary" onclick="saveCurrentShortcut()">Save Shortcut</button>
      </div>
    </div>
  </div>

  <script>
    // Global variables for modal state
    let currentModalIndex = -1;
    let currentModalBox = null;
    let currentShortcut = '';

    // Global shortcuts list (9 elements for numpad positions 0x1 to 0x9)
    let shortcutsList = new Array(9).fill('');

    // Global pressed keys tracking for toggle behavior
    let pressedKeys = new Set();
    let pressedKeyCodes = new Set();

    // WiFi Modal Functions
    function openWifiModal() {
      document.getElementById('wifiModal').style.display = 'block';
      // Clear previous values
      document.getElementById('ssidInput').value = '';
      document.getElementById('passwordInput').value = '';
      // Focus on SSID input
      setTimeout(() => {
        document.getElementById('ssidInput').focus();
      }, 100);
    }

    function closeWifiModal() {
      document.getElementById('wifiModal').style.display = 'none';
    }

    function togglePasswordVisibility() {
      const passwordInput = document.getElementById('passwordInput');
      const toggleIcon = document.getElementById('passwordToggleIcon');

      if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        toggleIcon.innerHTML = `
      <!-- Eye Off SVG -->
      <svg xmlns="http://www.w3.org/2000/svg" width="23" height="23" fill="none"
        viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round"
          d="M3 3l18 18M10.73 5.08A10.45 10.45 0 0112 5c5 0 9.27 3.11 
             11 7.5a10.9 10.9 0 01-4.07 4.99M6.88 6.88A10.47 10.47 0 001 12.5
             C2.73 16.89 7 20 12 20c1.61 0 3.13-.31 4.5-.88M9.88 9.88A3 3 0 0012 15
             a3 3 0 002.12-.88" />
      </svg>
    `;
      } else {
        passwordInput.type = 'password';
        toggleIcon.innerHTML = `
      <!-- Eye Open SVG -->
      <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 
        11-7.5c-1.73-4.39-6-7.5-11-7.5zm0 
        12.5c-2.76 0-5-2.24-5-5s2.24-5 
        5-5 5 2.24 5 5-2.24 5-5 5z"/>
      <circle cx="12" cy="12" r="2.5"/>
    `;
      }
    }

    function saveWifiCredentials(event) {
      event.preventDefault();

      const ssid = document.getElementById('ssidInput').value.trim();
      const password = document.getElementById('passwordInput').value;

      if (!ssid) {
        alert('Please enter a network name (SSID)');
        return;
      }

      if (!password) {
        alert('Please enter a password');
        return;
      }

      // Show loading state
      const submitBtn = event.target.querySelector('button[type="submit"]');
      const originalContent = submitBtn.innerHTML;
      submitBtn.innerHTML = 'Connecting...';
      submitBtn.disabled = true;

      // Send POST request to save WiFi credentials
      fetch("http://192.168.4.1/wifi", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          ssid: ssid,
          password: password
        })
      })
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          return response.text();
        })
        .then(data => {
          console.log("WiFi credentials saved:", data);
          alert("WiFi settings saved successfully! The device will now attempt to connect to the network.");
          closeWifiModal();
        })
        .catch(error => {
          console.error("Error saving WiFi credentials:", error);
          alert("Failed to save WiFi settings. Please check your connection and try again.");
        })
        .finally(() => {
          // Restore button state
          submitBtn.innerHTML = originalContent;
          submitBtn.disabled = false;
        });
    }


    document.addEventListener("DOMContentLoaded", function () {
      fetch("http://192.168.4.1/getkeymapping")
        .then(response => response.json())
        .then(data => {
          // Save mappings globally
          window.keyMappings = data;

          // Map keyMappings to shortcut boxes
          document.querySelectorAll('.key-box').forEach((box, index) => {
            const shortcutText = box.querySelector('.shortcut-text');
            if (data[index]) {
              shortcutText.textContent = data[index].join(" + ");
              shortcutsList[index] = data[index].join(" + "); // <-- Map to shortcutsList
            } else {
              shortcutText.textContent = "Click to assign";
              shortcutsList[index] = ""; // <-- Ensure empty if not present
            }
          });
        })
        .catch(err => {
          console.error("Error fetching key mappings:", err);
        });

      // Add these lines inside the DOMContentLoaded event listener

      // Add WiFi button event listener
      document.getElementById('wifiBtn').addEventListener('click', openWifiModal);

      // Add WiFi form submit event listener
      document.getElementById('wifiForm').addEventListener('submit', saveWifiCredentials);

      // Close WiFi modal when clicking outside
      document.getElementById('wifiModal').addEventListener('click', function (event) {
        if (event.target === this) {
          closeWifiModal();
        }
      });
    });


    // Global modal functions
    function openKeyboardModal(box, index) {
      currentModalIndex = index;
      currentModalBox = box;
      currentShortcut = '';

      const actionLabel = box.querySelector('.action-label').textContent;
      const modalTitle = document.getElementById('modalTitle');
      modalTitle.textContent = `Assign Shortcut for "${actionLabel}"`;

      // Show the modal
      document.getElementById('keyboardModal').style.display = 'block';

      // Update keyboard layout in modal
      if (window.updateKeyboardLayout) {
        window.updateKeyboardLayout();
      }

      // Clear any existing highlights
      if (window.clearAllKeys) {
        window.clearAllKeys();
      }

      console.log(`Modal opened for action: ${actionLabel}`);
    }

    function closeKeyboardModal() {
      document.getElementById('keyboardModal').style.display = 'none';

      // Hide/remove debug info
      const debugInfo = document.getElementById('debug-info');
      if (debugInfo) {
        debugInfo.remove();
      }

      if (window.clearAllKeys) {
        window.clearAllKeys();
      }
      currentModalIndex = -1;
      currentModalBox = null;
      currentShortcut = '';
      console.log('Modal closed');
    }

    function clearCurrentShortcut() {
      currentShortcut = '';

      // Clear all pressed keys
      pressedKeys.clear();
      pressedKeyCodes.clear();

      if (window.clearAllKeys) {
        window.clearAllKeys();
      }

      // Update debug info
      if (window.logKeyCombination) {
        window.logKeyCombination();
      }

      console.log('Current shortcut cleared - all keys deactivated');
    }

    function saveCurrentShortcut() {
      if (currentShortcut && currentModalBox) {
        const actionLabel = currentModalBox.querySelector('.action-label').textContent;

        // Update the shortcut text in the grid
        currentModalBox.querySelector('.shortcut-text').textContent = currentShortcut;

        // Save to the global shortcuts list (numpad position mapping)
        // 0x1 = index 0, 0x2 = index 1, 0x3 = index 2, etc.
        shortcutsList[currentModalIndex] = currentShortcut;

        // Print the complete shortcuts list to console
        console.log('=== COMPLETE SHORTCUTS LIST ===');
        console.log('Numpad Position -> Shortcut Mapping:');
        for (let i = 0; i < shortcutsList.length; i++) {
          const numpadPosition = `0x${i + 1}`;
          const shortcut = shortcutsList[i] || 'Not assigned';
          console.log(`${numpadPosition} (index ${i}): ${shortcut}`);
        }
        console.log('===============================');

        console.log(`Shortcut saved for "${actionLabel}": ${currentShortcut}`);
        alert(`Shortcut for "${actionLabel}" saved: ${currentShortcut}`);
        closeKeyboardModal();
      } else {
        alert('Please press a key combination first.');
      }
    }

    (function () {
      // Key mapping reference from keymapping.csv
      const keyMappingReference = {
        // Letters A-Z
        'a': 'a', 'b': 'b', 'c': 'c', 'd': 'd', 'e': 'e',
        'f': 'f', 'g': 'g', 'h': 'h', 'i': 'i', 'j': 'j',
        'k': 'k', 'l': 'l', 'm': 'm', 'n': 'n', 'o': 'o',
        'p': 'p', 'q': 'q', 'r': 'r', 's': 's', 't': 't',
        'u': 'u', 'v': 'v', 'w': 'w', 'x': 'x', 'y': 'y', 'z': 'z',

        // Digits 0-9
        '0': '0', '1': '1', '2': '2', '3': '3', '4': '4',
        '5': '5', '6': '6', '7': '7', '8': '8', '9': '9',

        // Special keys
        'Enter': 'KEY_ENTER',
        'Escape': 'KEY_ESC',
        'Backspace': 'KEY_BACKSPACE',
        'Tab': 'KEY_TAB',
        ' ': 'KEY_SPACE',
        'CapsLock': 'KEY_CAPS_LOCK',

        // Function keys
        'F1': 'KEY_F1', 'F2': 'KEY_F2', 'F3': 'KEY_F3', 'F4': 'KEY_F4',
        'F5': 'KEY_F5', 'F6': 'KEY_F6', 'F7': 'KEY_F7', 'F8': 'KEY_F8',
        'F9': 'KEY_F9', 'F10': 'KEY_F10', 'F11': 'KEY_F11', 'F12': 'KEY_F12',

        // Navigation keys
        'Insert': 'KEY_INSERT',
        'Delete': 'KEY_DELETE',
        'Home': 'KEY_HOME',
        'End': 'KEY_END',
        'PageUp': 'KEY_PAGE_UP',
        'PageDown': 'KEY_PAGE_DOWN',

        // Arrow keys
        'ArrowUp': 'KEY_UP_ARROW',
        'ArrowDown': 'KEY_DOWN_ARROW',
        'ArrowLeft': 'KEY_LEFT_ARROW',
        'ArrowRight': 'KEY_RIGHT_ARROW',

        // Modifier keys
        'Control': 'KEY_LEFT_CTRL',
        'Shift': 'KEY_LEFT_SHIFT',
        'Alt': 'KEY_LEFT_ALT',
        'Meta': 'KEY_LEFT_GUI',

        // Media keys
        'MediaPlayPause': 'KEY_MEDIA_PLAY_PAUSE',
        'MediaVolumeUp': 'KEY_MEDIA_VOLUME_UP',
        'MediaVolumeDown': 'KEY_MEDIA_VOLUME_DOWN',
        'MediaMute': 'KEY_MEDIA_MUTE'
      };

      // Enhanced key mapping for better detection
      const enhancedKeyMapping = {
        // Modifier keys with multiple possible names
        'ctrl': 'KEY_LEFT_CTRL',
        'control': 'KEY_LEFT_CTRL',
        'shift': 'KEY_LEFT_SHIFT',
        'alt': 'KEY_LEFT_ALT',
        'option': 'KEY_LEFT_ALT',
        'meta': 'KEY_LEFT_GUI',
        'cmd': 'KEY_LEFT_GUI',
        'command': 'KEY_LEFT_GUI',
        'win': 'KEY_LEFT_GUI',
        'windows': 'KEY_LEFT_GUI',

        // Special characters
        '`': 'KEY_BACKTICK',
        '-': 'KEY_MINUS',
        '=': 'KEY_EQUALS',
        '[': 'KEY_LEFT_BRACKET',
        ']': 'KEY_RIGHT_BRACKET',
        '\\': 'KEY_BACKSLASH',
        ';': 'KEY_SEMICOLON',
        "'": 'KEY_QUOTE',
        ',': 'KEY_COMMA',
        '.': 'KEY_PERIOD',
        '/': 'KEY_SLASH',

        // Additional function keys
        'printscreen': 'KEY_PRINT_SCREEN',
        'scrolllock': 'KEY_SCROLL_LOCK',
        'pausebreak': 'KEY_PAUSE_BREAK'
      };

      const macKeys = [
        "Esc", "F1", "F2", "F3", "F4", "F5", "F6", "F7", "F8", "F9", "F10", "F11", "F12",
        "`", "1", "2", "3", "4", "5", "6", "7", "8", "9", "0", "-", "=", "Delete",
        "Tab", "Q", "W", "E", "R", "T", "Y", "U", "I", "O", "P", "[", "]", "\\",
        "Caps", "A", "S", "D", "F", "G", "H", "J", "K", "L", ";", "'", "Enter",
        "Shift", "Z", "X", "C", "V", "B", "N", "M", ",", ".", "/", "Shift",
        "Control", "Option", "Command", { text: "Space", cls: "space" }, "Command", "Option", "←", "↑", "↓", "→"
      ];

      const winKeys = [
        "Esc", "F1", "F2", "F3", "F4", "F5", "F6", "F7", "F8", "F9", "F10", "F11", "F12",
        "`", "1", "2", "3", "4", "5", "6", "7", "8", "9", "0", "-", "=", "Backspace",
        "Tab", "Q", "W", "E", "R", "T", "Y", "U", "I", "O", "P", "[", "]", "\\",
        "Caps Lock", "A", "S", "D", "F", "G", "H", "J", "K", "L", ";", "'", "Enter",
        "Shift", "Z", "X", "C", "V", "B", "N", "M", ",", ".", "/", "Shift",
        "Ctrl", "Win", "Alt", { text: "Space", cls: "space" }, "Alt", "Win", "Menu", "←", "↑", "↓", "→"
      ];

      const keyboardKeysDiv = document.getElementById("keyboardKeys");
      const osSelect = document.getElementById("osSelect");
      const saveBtn = document.getElementById("saveBtn");
      const resetBtn = document.getElementById("resetBtn");

      // Track pressed keys for combination detection
      // const pressedKeys = new Set(); // Moved to global scope
      // const pressedKeyCodes = new Set(); // Moved to global scope

      // Predefined actions for shortcut boxes
      const actions = [
        "New Document",
        "Save File",
        "Copy Selection",
        "Paste Content",
        "Undo Action",
        "Find Text",
        "Toggle Fullscreen",
        "Print Document",
        "Refresh Page"
      ];

      // Close modal when clicking outside
      window.onclick = function (event) {
        const modal = document.getElementById('keyboardModal');
        if (event.target === modal) {
          closeKeyboardModal();
        }
      }

      // Close modal with Escape key
      document.addEventListener('keydown', function (event) {
        // Only handle key events if modal is open
        if (document.getElementById('keyboardModal').style.display === 'block') {
          event.preventDefault(); // <-- Always prevent default when modal is open

          const key = event.key;
          const keyCode = window.getKeyCode ? window.getKeyCode(key) : key;

          // Toggle key state - if already pressed, remove it; if not pressed, add it
          if (pressedKeys.has(key)) {
            pressedKeys.delete(key);
            pressedKeyCodes.delete(keyCode);
            if (window.highlightPressedKey) {
              window.highlightPressedKey(key, false);
            }
          } else {
            pressedKeys.add(key);
            pressedKeyCodes.add(keyCode);
            if (window.highlightPressedKey) {
              window.highlightPressedKey(key, true);
            }
          }

          // Update current shortcut based on all active keys
          if (pressedKeyCodes.size > 0) {
            const keyCombination = Array.from(pressedKeyCodes);
            currentShortcut = keyCombination.join('+');
          } else {
            currentShortcut = '';
          }

          // Log the combination
          if (window.logKeyCombination) {
            window.logKeyCombination();
          }
        }
      });

      // Make functions globally accessible
      window.updateKeyboardLayout = updateKeyboardLayout;
      window.clearAllKeys = clearAllKeys;
      window.getKeyCode = getKeyCode;
      window.shouldPreventDefault = shouldPreventDefault;
      window.highlightPressedKey = highlightPressedKey;
      window.logKeyCombination = logKeyCombination;
      window.handleCombinationRelease = handleCombinationRelease;
      window.cleanupStuckHighlights = cleanupStuckHighlights;
      window.scheduleCleanup = scheduleCleanup;
      window.updateDebugInfo = updateDebugInfo;
      window.createDebugInfo = createDebugInfo; // Added createDebugInfo to global scope

      function openRestartModal(onOk) {
        document.getElementById('restartModal').style.display = 'block';
        document.getElementById('restartOkBtn').onclick = function () {
          document.getElementById('restartModal').style.display = 'none';
          onOk();
        };
        document.getElementById('restartCancelBtn').onclick = closeRestartModal;
        document.getElementById('restartModalClose').onclick = closeRestartModal;
        // Also close modal if user clicks outside modal-content
        document.getElementById('restartModal').onclick = function (e) {
          if (e.target === this) closeRestartModal();
        };
      }
      function closeRestartModal() {
        document.getElementById('restartModal').style.display = 'none';
      }

      saveBtn.addEventListener("click", function () {
        openRestartModal(function () {
          console.log("OK clicked, preparing fetch...");

          const formattedList = shortcutsList.map(shortcut => {
            if (!shortcut) return [];
            return shortcut.split(/[+,]/).map(s => s.trim()).filter(Boolean);
          });

          fetch("http://192.168.4.1/savekeymapping", {   // <-- match FastAPI route
            method: "POST",
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify(formattedList)
          })
            .then(response => {
              if (!response.ok) throw new Error("Network response was not ok");
              return response.text();
            })
            .then(data => {
              console.log("Configuration saved:", data);
              alert("Shortcut configuration saved successfully!");
            })
            .catch(error => {
              console.error("Error saving configuration:", error);
              alert("Failed to save configuration. See console for details.");
            });
        });
      });

      resetBtn.addEventListener("click", function () {
        if (confirm("Are you sure you want to reset all shortcuts to default?")) {
          document.querySelectorAll('.key-box').forEach((box, index) => {
            box.querySelector('.shortcut-text').textContent = actions[index] || '';
            box.querySelector('.plus').style.display = 'block';
            box.querySelector('.hint').textContent = "Click to assign";
          });
          alert("All shortcuts have been reset to default!");
        }
      });

      osSelect.addEventListener("change", updateKeyboardLayout);

      // Key mapping for different OS
      const keyMappings = {
        mac: {
          'Escape': 'Esc',
          'Backspace': 'Delete',
          'CapsLock': 'Caps',
          'Meta': 'Command',
          'Alt': 'Option',
          'Control': 'Control',
          'Shift': 'Shift',
          'Enter': 'Enter',
          'Tab': 'Tab',
          ' ': 'Space',
          'ArrowLeft': '←',
          'ArrowUp': '↑',
          'ArrowDown': '↓',
          'ArrowRight': '→'
        },
        windows: {
          'Escape': 'Esc',
          'Backspace': 'Backspace',
          'CapsLock': 'Caps Lock',
          'Meta': 'Win',
          'Alt': 'Alt',
          'Control': 'Ctrl',
          'Shift': 'Shift',
          'Enter': 'Enter',
          'Tab': 'Tab',
          ' ': 'Space',
          'ArrowLeft': '←',
          'ArrowUp': '↑',
          'ArrowDown': '↓',
          'ArrowRight': '→',
          'ContextMenu': 'Menu'
        }
      };

      // Function to highlight pressed keys
      function highlightPressedKey(key, isPressed) {
        const os = osSelect.value;
        const keyMapping = keyMappings[os];
        const mappedKey = keyMapping[key] || key;

        const keyElements = document.querySelectorAll('.key-display');
        let foundMatch = false;

        keyElements.forEach(element => {
          const elementText = element.textContent;
          let shouldHighlight = false;

          // Check for exact match first
          if (elementText === mappedKey) {
            shouldHighlight = true;
          }
          // Check for case-insensitive match (for letters) - both for highlighting and unhighlighting
          else if (elementText.toLowerCase() === mappedKey.toLowerCase()) {
            shouldHighlight = true;
          }
          // Check for special mappings
          else if (key === 'Control' && (elementText === 'Control' || elementText === 'Ctrl')) {
            shouldHighlight = true;
          }
          else if (key === 'Shift' && elementText === 'Shift') {
            shouldHighlight = true;
          }
          else if (key === 'Alt' && (elementText === 'Alt' || elementText === 'Option')) {
            shouldHighlight = true;
          }
          else if (key === 'Meta' && (elementText === 'Command' || elementText === 'Win' || elementText === 'Meta')) {
            shouldHighlight = true;
          }
          // Check for arrow keys
          else if (key === 'ArrowUp' && elementText === '↑') {
            shouldHighlight = true;
          }
          else if (key === 'ArrowDown' && elementText === '↓') {
            shouldHighlight = true;
          }
          else if (key === 'ArrowLeft' && elementText === '←') {
            shouldHighlight = true;
          }
          else if (key === 'ArrowRight' && elementText === '→') {
            shouldHighlight = true;
          }
          // Check for space key
          else if (key === ' ' && elementText === 'Space') {
            shouldHighlight = true;
          }
          // Check for Enter key
          else if (key === 'Enter' && elementText === 'Enter') {
            shouldHighlight = true;
          }
          // Check for Tab key
          else if (key === 'Tab' && elementText === 'Tab') {
            shouldHighlight = true;
          }
          // Check for Escape key
          else if (key === 'Escape' && elementText === 'Esc') {
            shouldHighlight = true;
          }
          // Check for Backspace key
          else if (key === 'Backspace' && (elementText === 'Backspace' || elementText === 'Delete')) {
            shouldHighlight = true;
          }

          if (shouldHighlight) {
            foundMatch = true;
            if (isPressed) {
              element.classList.add('pressed');
              console.log(`✓ Highlighted: "${elementText}" for key "${key}"`);
            } else {
              element.classList.remove('pressed');
              console.log(`✗ Unhighlighted: "${elementText}" for key "${key}"`);
            }
          }
        });

        if (!foundMatch) {
          console.log(`⚠ No match found for key: "${key}" (mapped: "${mappedKey}")`);
        }
      }

      // Function to check if a key combination should be prevented
      function shouldPreventDefault(event) {
        const key = event.key;
        const hasModifiers = event.ctrlKey || event.shiftKey || event.altKey || event.metaKey;

        // Always prevent modifier keys alone
        if (key === 'Control' || key === 'Shift' || key === 'Alt' || key === 'Meta' ||
          key === 'Ctrl' || key === 'Cmd' || key === 'Command') {
          console.log(`Preventing modifier key alone: ${key}`);
          return true;
        }

        // Prevent ALL modifier key combinations (not just a specific list)
        if (hasModifiers) {
          const modifiers = [];
          if (event.ctrlKey) modifiers.push('Ctrl');
          if (event.shiftKey) modifiers.push('Shift');
          if (event.altKey) modifiers.push('Alt');
          if (event.metaKey) modifiers.push('Cmd');

          console.log(`Preventing modifier combination: ${modifiers.join('+')}+${key}`);
          return true;
        }

        return false;
      }

      // Function to clean up stuck highlights
      function cleanupStuckHighlights() {
        const keyElements = document.querySelectorAll('.key-display');
        keyElements.forEach(element => {
          const elementText = element.textContent;
          let shouldBeHighlighted = false;

          // Check if this key should be highlighted based on currently pressed keys
          for (let pressedKey of pressedKeys) {
            if (elementText.toLowerCase() === pressedKey.toLowerCase() ||
              elementText === pressedKey ||
              (pressedKey === 'Control' && (elementText === 'Control' || elementText === 'Ctrl')) ||
              (pressedKey === 'Shift' && elementText === 'Shift') ||
              (pressedKey === 'Alt' && (elementText === 'Alt' || elementText === 'Option')) ||
              (pressedKey === 'Meta' && (elementText === 'Command' || elementText === 'Win' || elementText === 'Meta'))) {
              shouldBeHighlighted = true;
              break;
            }
          }

          // Remove highlight if it shouldn't be highlighted
          if (!shouldBeHighlighted && element.classList.contains('pressed')) {
            element.classList.remove('pressed');
            console.log(`Cleaned up stuck highlight: "${elementText}"`);
          }
        });
      }

      // Function to handle combination release
      function handleCombinationRelease(releasedKey) {
        // If a modifier key is released, clear all highlights
        if (releasedKey === 'Control' || releasedKey === 'Shift' || releasedKey === 'Alt' ||
          releasedKey === 'Meta' || releasedKey === 'Ctrl' || releasedKey === 'Cmd' ||
          releasedKey === 'Command') {
          console.log(`Modifier key released: ${releasedKey} - clearing all highlights`);

          // Clear all highlights from virtual keyboard
          const keyElements = document.querySelectorAll('.key-display');
          keyElements.forEach(element => {
            element.classList.remove('pressed');
          });

          // Clear all pressed keys
          pressedKeys.clear();
          pressedKeyCodes.clear();

          console.log('All keys cleared due to modifier release');
        }
      }

      // Function to schedule cleanup of stuck highlights
      function scheduleCleanup() {
        // Clear any existing timeout
        if (window.cleanupTimeout) {
          clearTimeout(window.cleanupTimeout);
        }

        // Schedule cleanup after 100ms
        window.cleanupTimeout = setTimeout(() => {
          if (pressedKeys.size === 0 && pressedKeyCodes.size === 0) {
            // If no keys are pressed but some are still highlighted, clear them
            const keyElements = document.querySelectorAll('.key-display.pressed');
            if (keyElements.length > 0) {
              console.log('Auto-cleaning stuck highlights');
              keyElements.forEach(element => {
                element.classList.remove('pressed');
              });
            }
          }
        }, 100);
      }

      // Function to convert key to keycode
      function getKeyCode(key) {
        const lowerKey = key.toLowerCase();

        // Check enhanced mapping first (for modifier keys and special cases)
        if (enhancedKeyMapping[lowerKey]) {
          return enhancedKeyMapping[lowerKey];
        }

        // Check main key mapping reference
        if (keyMappingReference[lowerKey]) {
          return keyMappingReference[lowerKey];
        }

        // Check original key name
        if (keyMappingReference[key]) {
          return keyMappingReference[key];
        }

        // Handle special cases for modifier keys
        if (key === 'Control' || key === 'Ctrl') return 'KEY_LEFT_CTRL';
        if (key === 'Shift') return 'KEY_LEFT_SHIFT';
        if (key === 'Alt' || key === 'Option') return 'KEY_LEFT_ALT';
        if (key === 'Meta' || key === 'Cmd' || key === 'Command') return 'KEY_LEFT_GUI';

        // Handle single character keys (letters, numbers, symbols)
        if (key.length === 1) {
          if (/[a-zA-Z]/.test(key)) {
            return `KEY_${key.toUpperCase()}`;
          }
          if (/[0-9]/.test(key)) {
            return `KEY_${key}`;
          }
          // For other single characters, return as is
          return key;
        }

        // Return the original key if no mapping found
        return key;
      }

      // Function to log key combinations
      function logKeyCombination() {
        // Update debug info with current combination and shortcuts list
        let debugText = 'Click anywhere to focus - then press keys to test\n\n';

        if (pressedKeyCodes.size > 0) {
          const keyCombination = Array.from(pressedKeyCodes).sort();
          console.log('Key combination pressed:', keyCombination);

          debugText += 'Current Combination:\n';
          debugText += `[${keyCombination.join(', ')}]\n\n`;

          // Log individual key details for debugging
          console.log('Individual keys:', Array.from(pressedKeys));
        } else {
          debugText += 'Current Combination:\n';
          debugText += 'No keys active\n\n';
          console.log('No keys active');
        }

        debugText += 'Existing Shortcuts:\n';
        for (let i = 0; i < shortcutsList.length; i++) {
          const numpadPosition = `0x${i + 1}`;
          const shortcut = shortcutsList[i] || 'Not assigned';
          debugText += `${numpadPosition}: ${shortcut}\n`;
        }

        const debugInfo = document.getElementById('debug-info');
        if (debugInfo) {
          debugInfo.textContent = debugText;
        }
      }

      // Function to clear all pressed keys
      function clearAllKeys() {
        // Clear all pressed key highlights from the virtual keyboard
        const keyElements = document.querySelectorAll('.key-display');
        keyElements.forEach(element => {
          element.classList.remove('pressed');
        });

        pressedKeys.clear();
        pressedKeyCodes.clear();
        console.log('All keys cleared manually');

        // Update debug info
        const debugInfo = document.getElementById('debug-info');
        if (debugInfo) {
          debugInfo.textContent = 'No keys pressed';
        }
      }

      // Function to create debug info element
      function createDebugInfo() {

      }

      // Function to update debug info
      function updateDebugInfo(message) {

      }

      function updateKeyboardLayout() {
        const os = osSelect.value;
        const keys = os === "mac" ? macKeys : winKeys;

        let rowHtml = '';
        keys.forEach((key, i) => {
          if (i % 14 === 0) rowHtml += '<div class="keyboard-row">';

          if (typeof key === 'object') {
            rowHtml += `<span class="key-display ${key.cls || ''}">${key.text}</span>`;
          } else {
            rowHtml += `<span class="key-display">${key}</span>`;
          }

          if ((i + 1) % 14 === 0 || i === keys.length - 1) rowHtml += '</div>';
        });

        keyboardKeysDiv.innerHTML = rowHtml;
      }

      // Handle keyup events
      document.addEventListener('keyup', function (event) {
        // Only handle key events if modal is open
        if (document.getElementById('keyboardModal').style.display === 'block') {
          const key = event.key;
          const keyCode = window.getKeyCode ? window.getKeyCode(key) : key;

          console.log(`Keyup event triggered for: "${key}" -> "${keyCode}"`);

          // Note: We don't remove keys on keyup anymore since we want toggle behavior
          // Keys will only be removed when pressed again (toggled off)

          // Clean up any stuck highlights (but don't remove from pressed sets)
          if (window.cleanupStuckHighlights) {
            window.cleanupStuckHighlights();
          }

          // Schedule additional cleanup
          if (window.scheduleCleanup) {
            window.scheduleCleanup();
          }

          console.log(`Key released (but may still be active): ${key} -> ${keyCode}`);

          // Log final combination if any keys are still pressed
          if (pressedKeyCodes.size > 0) {
            const remainingCombination = Array.from(pressedKeyCodes).sort();
            console.log('Active keys:', remainingCombination);
          } else {
            console.log('No keys active');
          }
        }
      });

      // Handle window blur to clear all pressed keys
      window.addEventListener('blur', function () {
        // Only clear keys if modal is open
        if (document.getElementById('keyboardModal').style.display === 'block') {
          if (window.clearAllKeys) {
            window.clearAllKeys();
          }
          console.log('All keys cleared (window blur)');
        }
      });

      // Handle window focus to ensure clean state
      window.addEventListener('focus', function () {
        // Only handle focus events if modal is open
        if (document.getElementById('keyboardModal').style.display === 'block') {
          console.log('Window focused - cleaning up any stuck highlights');
          if (window.cleanupStuckHighlights) {
            window.cleanupStuckHighlights();
          }
          if (window.updateDebugInfo) {
            window.updateDebugInfo('Window focused - ready for keyboard input');
          }
        }
      });

      // Handle clicks to ensure focus
      document.addEventListener('click', function () {
        // Only handle click events if modal is open
        if (document.getElementById('keyboardModal').style.display === 'block') {
          console.log('Document clicked - ensuring focus for keyboard input');
          window.focus();
        }
      });

      // Handle document visibility change to clear keys when tab is switched
      document.addEventListener('visibilitychange', function () {
        // Only clear keys if modal is open and tab is hidden
        if (document.hidden && document.getElementById('keyboardModal').style.display === 'block') {
          if (window.clearAllKeys) {
            window.clearAllKeys();
          }
          console.log('All keys cleared (tab hidden)');
        }
      });

      // Initial render
      updateKeyboardLayout();

      console.log('Keyboard shortcut manager loaded with modal functionality');
      console.log('Click any key card to open the keyboard modal');
    })();
  </script>
  <!-- Add this modal just before the closing </body> tag -->
  <div id="restartModal" class="modal">
    <div class="modal-content" style="max-width:400px;">
      <div class="modal-header">
        <h2 class="modal-title">Restart Required</h2>
        <span class="close" id="restartModalClose">&times;</span>
      </div>
      <div style="padding: 20px 0; color: #ffd700; text-align: center;">
        Once saved, the device will restart.<br>Click OK to proceed.
      </div>
      <div class="modal-controls">
        <button class="modal-btn primary" id="restartOkBtn">OK</button>
        <button class="modal-btn secondary" id="restartCancelBtn">Cancel</button>
      </div>
    </div>
  </div>
  <!-- WiFi Settings Modal -->
  <div id="wifiModal" class="modal">
    <div class="modal-content" style="max-width: 500px;">
      <div class="modal-header">
        <h2 class="modal-title">WiFi Network Settings</h2>
        <span class="close" onclick="closeWifiModal()">&times;</span>
      </div>

      <div class="wifi-info">
        <div class="wifi-info-title">Configure Network Connection</div>
        <div class="wifi-info-text">Enter your WiFi network credentials to connect the device to your wireless network.
        </div>
      </div>

      <form class="wifi-form" id="wifiForm">
        <div class="form-group">
          <label class="form-label" for="ssidInput">Network Name (SSID)</label>
          <input type="text" id="ssidInput" class="form-input" placeholder="Enter WiFi network name" required
            autocomplete="off" />
        </div>

        <div class="form-group">
          <label class="form-label" for="passwordInput">Password</label>
          <div class="password-container">
            <input type="password" id="passwordInput" class="form-input" placeholder="Enter WiFi password" required
              autocomplete="off" />
            <button type="button" class="password-toggle" onclick="togglePasswordVisibility()">
              <svg id="passwordToggleIcon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                viewBox="0 0 24 24">
                <!-- Eye Open (default) -->
                <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zm0 12.5c-2.76 0-5-2.24-5-5s2.24-5 
      5-5 5 2.24 5 5-2.24 5-5 5z" />
                <circle cx="12" cy="12" r="2.5" />
              </svg>
            </button>
          </div>
        </div>

        <div class="modal-controls">
          <button type="button" class="modal-btn secondary" onclick="closeWifiModal()">Cancel</button>
          <button type="submit" class="modal-btn primary">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path
                d="M1 9l2 2c4.97-4.97 13.03-4.97 18 0l2-2C16.93 2.93 7.07 2.93 1 9zm8 8l3 3 3-3c-1.65-1.66-4.34-1.66-6 0zm-4-4l2 2c2.76-2.76 7.24-2.76 10 0l2-2C15.14 9.14 8.87 9.14 5 13z" />
            </svg>
            Save WiFi Settings
          </button>
        </div>
      </form>
    </div>
  </div>
</body>

</html>